# Aftermath (400 points / 27 solves)

In a twist of fate akin to the Death Note's dark intrigue, a secret is locked away

## Overview

We are given an AES-encrypted flag in a file aftermath.bin. The encryption uses AES in ECB mode with a key that is generated deterministically using Python's random module, seeded with a specific value (`random.seed(1234)`). The format of the flag is known to be `BsidesDehradun{}`, and our goal is to crack the seed used to generate the key and decrypt the flag.

## Key Generation & Encryption

The encryption key is generated by seeding Python's random number generator with 1234 and then generating 16 random bytes for the AES key:

```py
random.seed(1234)
key = bytes([random.randint(0, 255) for _ in range(16)])
```

The flag is then padded to the AES block size and encrypted in ECB mode:

```py
cipher = AES.new(key, AES.MODE_ECB)
encrypted_flag = cipher.encrypt(padded_flag)
```

## Solve

Technically, since the key generation process is deterministic, if we try enough seeds, we can regenerate the correct key and decrypt the flag.
For each seed, we regenerate the AES key, decrypt the ciphertext, and check if the decrypted result matches the known flag format `BsidesDehradun{}`. 
And by this we can make our solve script:

```py
from Crypto.Cipher import AES
from Crypto.Util.Padding import unpad
import random
import string

with open("Afteramth.bin", "rb") as f:
    encrypted_flag = f.read()
    
flag_format = "BsidesDehradun{"

def decrypt(seed, encrypted_flag):
    random.seed(seed)
    key = bytes([random.randint(0, 255) for _ in range(16)])
    cipher = AES.new(key, AES.MODE_ECB)
    
    try:
        decrypted_flag = unpad(cipher.decrypt(encrypted_flag), AES.block_size)
        return decrypted_flag.decode()
    except (ValueError, UnicodeDecodeError):
        return None

for seed in range(1000001): 
    decrypted_flag = decrypt(seed, encrypted_flag)
    if decrypted_flag and decrypted_flag.startswith(flag_format):
        print(f"Seed: {seed}")
        print(f"Decrypted flag: {decrypted_flag}")
        break
```

`Seed: 1234`
`Decrypted flag: BsidesDehradun{W1tn3ss_Th3_Aft3rm4th!}`
